/*!
	fiug editor component
	Version v0.4.6
	Build Date 2021-10-30T05:22:21.681Z
	https://github.com/crosshj/fiug
	(c) 2020-2021 Harrison Cross.
*/
let allServices,currentService$1;const dummyFunc=(t,e="")=>(...n)=>(console.log({...n,fnName:t}),e),getCurrentFile=dummyFunc("getCurrentFile"),getCurrentFileFull=()=>currentService$1.state.selected,setCurrentFile=({filePath:t})=>{const e=currentService$1.code.find((e=>e.name===t||e.path==="/"+t||e.path==="/"+currentService$1.name+"/"+t));if(e)return currentService$1.state.selected=e,void(currentService$1.state.selected.filename=e.name);console.error(`could not find ${t}`)},getAllServices=()=>allServices,getCurrentService=()=>currentService$1,getState$1=dummyFunc("getState"),setState=dummyFunc("setState"),getSettings=dummyFunc("getSettings",{indentWithTabs:!0,tabSize:2}),initState=(t,e)=>{allServices=t,currentService$1=e};var ext={mp3:"audio",wav:"audio",ogg:"audio",adb:"ada",ads:"ada",adoc:"asciidoc",apl:"apl",bowerrc:"bower",bf:"brainfuck",cs:"csharp",c:"c",h:"c",m:"c",ctp:"cake_php",clj:"clojure",cljc:"clojure",cljs:"clojure",cjsx:"react",jsx:"react",tmp:"clock",coffee:"coffee",cfc:"coldfusion",cfm:"coldfusion",config:"config",cpp:"cpp",cr:"crystal",cs:"csharp",css:"css",dart:"dart",sss:"css",csv:"csv",edn:"clojure",editorconfig:"config",ejs:"ejs",elm:"elm",ttf:"font",woff:"font",woff2:"font",eot:"font",gitkeep:"git",gitconfig:"git",gitattributes:"git",gitmodules:"git",gitignore:"git",go:"go",gradle:"gradle",grails:"grails",groovy:"grails",hh:"hacklang",haml:"haml",hs:"haskell",lhs:"haskell",lisp:"lisp",htm:"html",html:"html",shtml:"html",dhtml:"html",ai:"ai",png:"image",ico:"image",jpg:"image",bmp:"image",jpeg:"image",gif:"image",jade:"jade",java:"java",mjs:"javascript",js:"javascript",es6:"javascript",es7:"javascript",erl:"erlang",ex:"elixir",gltf:"json",ipynb:"json",json:"json",jl:"julia",less:"less",license:"license",liquid:"liquid",ls:"livescript",lua:"lua",md:"markdown",mustache:"mustache",handlebars:"mustache",hbs:"mustache",hjs:"mustache",stache:"mustache",npmignore:"npm",ml:"ocaml",mli:"ocaml",cmx:"ocaml",cmxa:"ocaml",pdf:"pdf",pl:"perl",pro:"prolog",psd:"photoshop",php:"php","php.inc":"php",pug:"pug",pp:"puppet",py:"python",rb:"ruby","erb.html":"ruby","html.erb":"ruby",rs:"rust",sass:"sass",scss:"sass",scm:"scheme",sbt:"sbt",scala:"scala",sql:"sql",sh:"shell",cmd:"shell",zsh:"shell",fish:"shell",profile:"shell",slim:"slim",smarty:"smarty","smarty.tpl":"smarty",styl:"stylus",svg:"svg",swift:"swift",tf:"terraform","tf.json":"terraform",tex:"tex",sty:"tex",cls:"tex",dtx:"tex",ins:"tex",txt:"default",twig:"twig",as:"assemblyscript",ts:"typescript",tsx:"react",direnv:"config",env:"config",static:"config",slugignore:"config",vala:"vala",wmv:"video",mov:"video",ogv:"video",webm:"video",avi:"video",mpg:"video",mp4:"video",xml:"xml",yml:"yml",yaml:"yml",vue:"vue",babelrc:"babel",eslintrc:"eslint",jshintrc:"jshint",xcodeproj:"xcode",zip:"zip",rar:"zip",gz:"zip",iso:"zip",key:"key",pem:"key",fs:"fsharp",vimrc:"vim",vim:"vim",viminfo:"vim",sql:"sql",bat:"shell",htaccess:"apache",wxml:"wxml",wxss:"wxss",ini:"config",clj:"clojure",r:"r",lock:"lock",asp:"asp",flowconfig:"flow",nim:"nim",kt:"kotlin",ink:"ink",zig:"zig",pas:"pascal",raku:"raku",fth:"forth",d:"d",pony:"pony",ppm:"ppm",wat:"wat",piskel:"image",scratch:"smarty",bugs:"platformio"};function codemirrorModeFromFileType(t){return{assemblyscript:{name:"javascript",typescript:!0,assemblyscript:!0},apl:"text/apl",config:"text/x-properties",typescript:{name:"javascript",typescript:!0},react:"jsx",svg:"xml",html:{name:"htmlmixed",tags:{style:[["type",/^text\/(x-)?scss$/,"text/x-scss"],[null,null,"css"]],custom:[[null,null,"customMode"]]}},sass:"text/x-scss",less:"text/x-less",image:{name:"default"},bat:{name:"default"},mjs:{name:"javascript"},json:{name:"javascript",json:!0},c:"text/x-csrc",cpp:"text/x-c++src",ocaml:"text/x-ocaml",fsharp:"text/x-fsharp",csharp:"text/x-csharp",java:"text/x-java",kotlin:"text/x-kotlin",lisp:"commonlisp",raku:"perl6",yml:"text/x-yaml",zig:"rust",sql:"text/x-pgsql"}[t]||t}function htmlToElement(t){var e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild}let getMime=()=>{};(async()=>{const source=await(await fetch("/modules/service-worker.utils.js")).text(),SWUtils=eval(`\n\t\t(function(){\n\t\tconst module = { exports: {} };\n\t\t${source}\n\t\tconst { exports } = module;\n\t\treturn exports;\n\t\t})()\n\t`);SWUtils.initMimeTypes(),getMime=SWUtils.getMime})();const getExtension=t=>((t.match(/\.[0-9a-z]+$/i)||[])[0]||"").replace(/^\./,"");function getFileType(t=""){const e=getMime(t)||{};let n="default";const r=getExtension(t);return e?.contentType&&(n=e.contentType),".git/config"===t.toLowerCase()&&(n="config"),"license"===t.toLowerCase()&&(n="license"),ext[r]&&(n=ext[r]),"bat"===r&&(n="bat"),"scratch"===r&&(n="markdown"),"piskel"===r&&(n="application/json"),"bugs"===r&&(n="markdown"),"wat"===r&&(n="text/webassembly"),"htm"!==r&&"html"!==r||(n={name:"htmlmixed",mimeType:"application/x-ejs",icon:"html"}),"hbs"===r&&(n={name:"handlebars",base:"text/html"}),n}function friendlyModeName(t,e){return t.includes&&t.includes("sharp")?t.replace("sharp","#"):"cpp"===t?"C++":"ocaml"===t?{name:"OCaml"}:["bat","cpp","lisp","raku","zig"].includes(t)||e.includes&&e.includes("text/x-")?t:e}const showFileInEditor=(t,e)=>{const n=getFileType(t);return!(["image","font","audio","video","zip"].includes(n)||"string"==typeof n&&n.includes("image/"))},noFrontSlash=t=>{try{return t&&(t.includes("/")&&"/"===t[0])?t.slice(1):t}catch(t){}},pathNoServiceName=(t,e)=>e.includes("/")?e.includes(t.name)?noFrontSlash(noFrontSlash(e).replace(t.name,"")):noFrontSlash(e):e,getFilePath$1=t=>({name:e="",parent:n="",path:r="",next:o="",nextPath:i=""})=>{const a=(t,e)=>t?t.endsWith(e)?noFrontSlash(t):noFrontSlash(`${t}/${e}`):noFrontSlash(e),s=o?a(i,o):a(n||r,e),c=t({pure:!0});return pathNoServiceName(c,s)},flatFromProp=(t,e)=>t.flatMap((({[e]:t,...n})=>void 0!==t&&t.length?t.map((t=>({...n,...t}))):n)),formatHandlers=(t,e)=>Object.entries(e).reduce(((e,[n,r])=>({...e,[n]:{listener:r,name:t}})),{});function scrollToChild(t){window.parent=t.parentNode;const e=parent.scrollLeft,n=parent.scrollLeft+parent.clientWidth,r=parent.scrollWidth-parent.clientWidth,o=t.offsetLeft,i=t.offsetLeft+t.clientWidth,a=(o+i)/2-parent.clientWidth/2,s=i>e&&o<e?parent.scrollLeft-(e-o)-20:void 0,c=i>n&&o<n?parent.scrollLeft+(i-n)+20:void 0;if(0===o)return void parent.scrollTo({top:0,left:0,behavior:"smooth"});if(i===parent.scrollWidth)return void parent.scrollTo({top:0,left:r,behavior:"smooth"});return o>=e&&i<=n?void 0:s?(console.log({idealScrollMin:s}),void parent.scrollTo({top:0,left:s,behavior:"smooth"})):c?(console.log({idealScrollMax:c}),void parent.scrollTo({top:0,left:c,behavior:"smooth"})):void(a<=0?parent.scrollTo({top:0,left:0,behavior:"smooth"}):a<=r?parent.scrollTo({top:0,left:a,behavior:"smooth"}):parent.scrollTo({top:0,left:r,behavior:"smooth"}))}const createTab=(t,e)=>n=>{const r=document.createElement("div");let o,i,a;r.id=n.id,r.classList.add("tab"),e?r.classList.remove("new"):r.classList.add("new"),n.changed&&r.classList.add("changed"),n.touched&&r.classList.add("touched"),n.name.includes("system::")&&(o="config",i={"add-service-folder":"Open Folder","connect-service-provider":"Connect to a Provider","open-previous-service":"Open Previous Service","open-settings-view":"Settings"}[n.name.replace("system::","")],a="italic"),r.title=`${n.parent?n.parent+"/":""}${n.name.split("/").pop()}`;const s=getFileType(n.name),c=o||s.icon||s;r.innerHTML=`\n\t\t<span style="pointer-events: none;"\n\t\t\tclass="${a?a+" ":""}icon-${c}"\n\t\t>${i||n.name.split("/").pop()}</span>\n\t\t<div class="tab-close">\n\t\t\t<div class="monaco-action-bar animated">\n\t\t\t\t<ul class="actions-container" role="toolbar" aria-label="Tab actions">\n\t\t\t\t\t<li class="action-item" role="presentation">\n\t\t\t\t\t\t<a class="action-label icon close-editor-action"\n\t\t\t\t\t\t\tdata-name="${n.name}"\n\t\t\t\t\t\t\tdata-parent="${n.parent||""}"\n\t\t\t\t\t\t\trole="button"\n\t\t\t\t\t\t\ttitle="Close"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t`,t.appendChild(r),scrollToChild(r),n.active&&(r.classList.add("active"),r.classList.remove("new"));Array.from(t.querySelectorAll(".tab")).length},updateTab=t=>e=>{const n=t.querySelector("#"+e.id);n&&(!e.active&&n.classList.contains("active")&&n.classList.remove("active"),e.active&&!n.classList.contains("active")&&(n.classList.add("active"),scrollToChild(n)),e.changed&&!n.classList.contains("changed")&&(n.classList.add("changed"),scrollToChild(n)),!e.changed&&n.classList.contains("changed")&&n.classList.remove("changed"),!e.touched&&n.classList.contains("touched")&&n.classList.remove("touched"),e.touched&&n.classList.add("touched"))},removeTab=t=>async e=>{if(!e)return console.error("attempt to remove tab without a tab definition");const n=t.querySelector("#"+e.id);n.parentNode.removeChild(n);Array.from(t.querySelectorAll(".tab")).length},scrollHorizontally=t=>function(e){e=window.event||e,t.scrollLeft-=e.wheelDelta||-e.detail};function attachWheel(t){t&&(t.addEventListener?(t.addEventListener("mousewheel",scrollHorizontally(t),{passive:!0}),t.addEventListener("DOMMouseScroll",scrollHorizontally(t),{passive:!0})):t.attachEvent("onmousewheel",scrollHorizontally(t)))}function attachDoubleClick(t,e){t&&t.addEventListener("dblclick",(t=>{const{triggers:n}=e;n.addFileUntracked(t)}))}const initTabs=t=>(e=[],n)=>{Array.from(t.querySelectorAll(".tab")).map(removeTab(t));e.map(createTab(t,!0)),setTimeout((()=>{const t=document.querySelector("#editor-tabs");attachWheel(t),attachDoubleClick(t,n);const e=document.querySelector("#editor-tabs-container .active");e&&e.scrollIntoView()}),1e3)};let tabsContainer,tabsList;function EditorTabs(t=[{name:"loading...",active:!0}]){if(tabsContainer)return tabsList=tabsList||tabsContainer.querySelector("#editor-tabs"),tabsContainer;tabsContainer=document.createElement("div"),tabsContainer.innerHTML='\n\t\t<style>\n\t\t\t#editor-tabs-container .scrollbar {\n\t\t\t\tposition: absolute;\n\t\t\t\twidth: 575px;\n\t\t\t\theight: 3px;\n\t\t\t\tleft: 0px;\n\t\t\t\tbottom: 0px;\n\t\t\t\tbackground: transparent;\n\t\t\t\tright: -3px;\n\t\t\t\twidth: auto;\n\t\t\t}\n\t\t\t#editor-tabs-container .slider {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0px;\n\t\t\t\tleft: 0px;\n\t\t\t\theight: 3px;\n\t\t\t\twill-change: transform;\n\t\t\t\twidth: 508px;\n\t\t\t}\n\t\t\t#editor-tabs-container:hover .slider {\n\t\t\t\tbackground: #ffffff20;\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t#editor-tabs-container .tab:not(.touched):not(.changed) > span {\n\t\t\t\tfont-style: italic;\n\t\t\t}\n\t\t</style>\n\t\t<div class="scrollable hide-native-scrollbar" id="editor-tabs-container">\n\t\t\t<div id="editor-tabs" class="row no-margin">\n\t\t\t</div>\n\t\t\t<div class="invisible scrollbar horizontal fade">\n\t\t\t\t<div class="slider">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t',tabsList=tabsList||tabsContainer.querySelector("#editor-tabs");const e={initTabs:initTabs(tabsList),createTab:createTab(tabsList),updateTab:updateTab(tabsList),removeTab:removeTab(tabsList)};tabsContainer.sysDocNames={"add-service-folder":"Open Folder","connect-service-provider":"Connect to a Provider","open-previous-service":"Open Previous Service","open-settings-view":"Settings"},tabsContainer.operations=e;let n=[];return tabsContainer.api={list:()=>n,find:t=>n.find(t),update:t=>n=t,push:t=>n.push(t),clearLast:function({tabs:t,removeTab:e}){if(!t.length)return;const n=t[t.length-1];return n.changed||n.touched||n.name.includes("Untitled-")?void 0:(t=t.filter((t=>t.id!==n.id)),e(n),{tabs:t,cleared:n})},toUpdate:function(t){const e=t?.split("/").pop(),r=[];let o;for(var i=0,a=n.length;i<a;i++)e===n[i].name&&(o=n[i]),e!==n[i].name||n[i].active||(n[i].active=!0,r.push(n[i])),e!==n[i].name&&n[i].active&&(delete n[i].active,r.push(n[i]));return{foundTab:o,tabsToUpdate:r}}},tabsContainer}function StatusBar(){const t=document.createElement("div");t.id="status-bar";const e=getSettings(),n=t=>`${t.indentWithTabs?"Tabs":"Spaces"}: <span class="tab-size">${t.tabSize}</span>`;t.innerHTML=`\n\t<style>\n\t\t#status-bar {\n\t\t\tposition: absolute;\n\t\t\tbottom: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\theight: 22px;\n\t\t\tfont-size: 12px;\n\t\t\tpadding: 2px 10px;\n\t\t\tz-index: 10;\n\t\t\tborder-top: 0.5px solid #000A;\n\t\t\t/*\n\t\t\tbox-shadow: 0 -1px 5px #000F;\n\t\t\t*/\n\t\t}\n\t\t#status-bar .bg {\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\ttop: 0;\n\t\t\tbottom: 0;\n\t\t\tbox-sizing: border-box;\n\t\t\tbackground: #3333;\n\t\t\tpointer-events: none;\n\t\t\tbackground: #0006;\n\t\t\tz-index: -1;\n\t\t\t/*\n\t\t\tborder-top: 1px solid #111a;\n\t\t\tbackground: #1f476b;\n\t\t\tbackground: #4f263d;\n\t\t\tbackground: rgb(var(--main-theme-highlight-color));\n\t\t\tfilter: brightness(0.6);\n\t\t\t*/\n\t\t}\n\t\t#status-bar, #status-bar * {\n\t\t\tcursor: default;\n\t\t}\n\t\t#status-bar a:hover { color: white }\n\t\t#status-bar a { color: #dadada; }\n\n\t\t/*\n\t\t#status-bar a { color: var(--main-theme-text-invert-color); }\n\t\t#status-bar a { color: white; }\n\t\t#status-bar a:hover { color: var(--main-theme-text-color); }\n\t\t#status-bar a { color: var(--main-theme-text-color); }\n\t\t*/\n\n\t\t.statusbar-item { z-index: 1; }\n\t\t.statusbar-item.right a {\n\t\t\tmargin-left: 10px;\n\t\t}\n\t\t#status-bar .editor-status-mode {\n\t\t\ttext-transform: capitalize;\n\t\t}\n\t\t#status-bar .editor-status-mode.uppercase {\n\t\t\ttext-transform: uppercase !important;\n\t\t}\n\t</style>\n\n\t<div class="bg"></div>\n\n\t<div class="statusbar-item statusbar-entry left" statusbar-entry-priority="10000" statusbar-entry-alignment="0">\n\t</div>\n\n\t<div class="statusbar-item right">\n\t\t<div class="editor-statusbar-item">\n\t\t\t<a class="editor-status-selection" title="Go to Line" style="">\n\t\t\t\tLine <span class="line-number">--</span>,\n\t\t\t\tCol <span class="column-number">--</span>\n\t\t\t</a>\n\t\t\t<a class="editor-status-indentation" title="Select Indentation" style="">${n(e)}</a>\n\t\t\t<a class="editor-status-encoding hidden" title="Select Encoding" style="">UTF-8</a>\n\t\t\t<a class="editor-status-eol hidden" title="Select End of Line Sequence" style="">LF</a>\n\t\t\t<a class="editor-status-mode" title="Select Language Mode" style="">--</a>\n\t\t</div>\n\t</div>\n`;const r=t.querySelector(".editor-status-indentation");return r.addEventListener("click",(()=>{e.indentWithTabs=!e.indentWithTabs,localStorage.setItem("editorSettings",JSON.stringify(e)),r.innerHTML=n(e),Editor.setOption("indentWithTabs",e.indentWithTabs)})),document.body.appendChild(t),{operations:{setLineNumber:function(e){t.querySelector(".editor-status-selection .line-number").innerHTML=e},setColNumber:function(e){t.querySelector(".editor-status-selection .column-number").innerHTML=e},setTabSize:function(e){t.querySelector(".editor-status-indentation .tab-size").innerHTML=e},setDocType:function(e){const n=t.querySelector(".editor-status-mode");n.classList.remove("uppercase");let r=e;e.json&&(r="json"),e.typescript&&(r="TypeScript"),e.assemblyscript&&(r="AssemblyScript"),e.name&&e.name.includes("html")&&(r="html");const o={default:"Plain Text","text/x-csrc":"C","text/x-c++src":"C++",wat:"WebAssembly",piskel:"Piskel",javascript:"JavaScript","text/apl":"APL"};for(o[e]&&(r=o[e]);r.toString().includes("object");)r=r.name?r.name:"Plain Text";r.toLowerCase&&["css","html","json","xml","jsx","php","sql"].includes(r.toLowerCase())&&n.classList.add("uppercase"),n.innerHTML=r}},container:t}}getSettings();const codeMirrorCssUrl="../shared/css/codemirror.css",codeMirrorBespinThemeCssUrl="../shared/css/bespin.css",cmVSCodeUrl="../shared/css/vscode.codemirror.css",codeMirrorJsUrl="../shared/vendor/codemirror.js",codeMirrorJsSyntaxUrl="../shared/vendor/codemirror/mode/javascript.js",codeMirrorAddonBundleUrl="../shared/vendor/codemirror/addon.bundle.js",appendScript=(t,e)=>{var n=document.createElement("script");return n.crossOrigin="anonymous",n.onload=e,n.src=t,document.head.appendChild(n),n},appendStyleSheet=(t,e)=>{var n=document.createElement("link");n.rel="stylesheet",n.crossOrigin="anonymous",n.onload=e,n.href=t,document.head.appendChild(n)},codeMirrorCss=t=>{appendStyleSheet(codeMirrorCssUrl,(()=>{appendStyleSheet(cmVSCodeUrl,(()=>{appendStyleSheet(codeMirrorBespinThemeCssUrl,t)}))}))},codeMirrorJs=t=>{appendScript(codeMirrorJsUrl,(()=>{appendScript(codeMirrorAddonBundleUrl,t)}))},codeMirrorModeJs=(t,e)=>{const n=`cm-syntax-${t}`;if(!!document.getElementById(n))return void e();const r=codeMirrorJsSyntaxUrl.replace("javascript",t.name||t);appendScript(r,e).id=n},setupEditor=(t,e)=>{const n="true"===window.localStorage.getItem("themeDark"),r={...{lineNumbers:!0,mode:e.mode,theme:n?"vscode-dark":"",styleActiveLine:!0,matchBrackets:!0},...e},o=document.querySelector(".simulation .functionInput");if(!o)return;const i=CodeMirror.fromTextArea(o,r);return CodeMirror.keyMap.default["Shift-Tab"]="indentLess",CodeMirror.keyMap.default.Tab="indentMore",i.getDoc().setValue(t),i},getModeWithEffects=t=>{let e=t.mode||"javascript";try{e=t.mode.name||e}catch(t){}return"lisp"===e&&(t.mode="commonlisp",e="commonlisp"),"ink"===e&&(t.mode="go",e="go"),"raku"===e&&(t.mode="perl6",e="perl6"),"zig"===e&&(t.mode="rust",e="rust"),"sql"===e&&(t.mode="text/x-pgsql"),"cpp"===e&&(t.mode="text/x-c++src"),["ocaml","csharp","fsharp","java","kotlin"].includes(e)&&(t.mode="text/x-"+e),"c"===e&&(t.mode="text/x-"+e),"config"===e&&(t.mode="text/x-properties"),e};async function loadDeps(t,e,n){codeMirrorCss((()=>{codeMirrorJs((()=>{codeMirrorModeJs("../mode.bundle",(()=>{stack.length>0&&(({text:t,opts:e,callback:n}=stack.pop()),stack=[]);let r=setupEditor(t,e||{});r?(window.EditorLoading=!1,window.Editor=r,n(null,r)):setTimeout((()=>{r=setupEditor(t,e||{}),r||console.log("STUBBORN editor..."),window.EditorLoading=!1,window.Editor=r,n(null,r)}),1e3)}))}))}))}let stack=[];const allTheEditorThings=({text:t="",...e}={},n)=>{let r=t;"string"!=typeof r&&(r="\n",console.warn("Editor received bad text!"),console.warn({text:t,opts:e}));let o=getModeWithEffects(e);if(window.EditorLoading)stack.push({text:r,opts:e,callback:n});else{if(window.Editor){e.mode=e.mode.mimeType||e.mode||o,window.Editor.toTextArea();const t=setupEditor(r,e||{});return window.Editor=t,void n(null,t)}window.EditorLoading=!0,loadDeps(r,e,n)}},Container=()=>{const t=document.querySelector("#full-page-container");t&&t.parentNode.removeChild(t);const e=document.createElement("div");return e.innerHTML='\n\t\t<div class="editor-space hide-on-med-and-down"></div>\n\t\t<div class="contain"></div>\n\t',e.classList.add("section","simulation","editor"),e.id="full-page-container",e.classList.add("section","simulation","editor"),document.querySelector("#editor").appendChild(e),e},Search=()=>{const t=document.createElement("div");return t.id="file-search",t.innerHTML='\n\t\t<style>\n\t\t\t#file-search {\n\t\t\t\tvisibility: hidden;\n\t\t\t\tposition: absolute;\n\t\t\t\tbackground: var(--main-theme-color);\n\t\t\t\theight: 34px;\n\t\t\t\tbox-shadow: inset 0px -2px 0px 0px var(--theme-subdued-color);\n\t\t\t\t/* border: 3px solid var(--main-theme-color); */\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\tcursor: default;\n\t\t\t\tborder-bottom: 6px solid var(--main-theme-color);\n\t\t\t\tbox-sizing: content-box;\n\t\t\t\tright: 8px;\n\t\t\t\tleft: 0;\n\t\t\t\twidth: auto;\n\t\t\t\tpadding: 0.45em;\n\t\t\t\tz-index: 10;\n\t\t\t}\n\t\t\t.collapse-handle {\n\t\t\t\twidth: 1.5em;\n\t\t\t\ttext-align: center;\n\t\t\t\tfont-stretch: expanded;\n\t\t\t\tfont-family: system-ui, monospace;\n\t\t\t\tfont-size: 1.2em;\n\t\t\t}\n\t\t\t.search-field {\n\t\t\t\tmargin-left: 0;\n\t\t\t\tflex: 1;\n\t\t\t\theight: 75%;\n\t\t\t}\n\t\t\t.search-field input {\n\t\t\t\theight: 100% !important;\n\t\t\t\tbackground: var(--main-theme-background-color) !important;\n\t\t\t\tmargin: 0 !important;\n\t\t\t\tborder: 0 !important;\n\t\t\t\tcolor: var(--main-theme-text-color);\n\t\t\t\tpadding-left: .5em !important;\n\t\t\t\tpadding-right: .5em !important;\n\t\t\t\tfont-size: 1.1em !important;\n\t\t\t\tbox-sizing: border-box !important;\n\t\t\t\ttransition: unset !important;\n\t\t\t}\n\t\t\t.search-field input:focus {\n\t\t\t\tborder: 1px solid !important;\n\t\t\t\tbox-shadow: none !important;\n\t\t\t\tborder-color: rgb(var(--main-theme-highlight-color)) !important;\n\t\t\t}\n\t\t\t.search-count,\n\t\t\t.search-no-results {\n\t\t\t\tmargin-left: 1.2em;\n\t\t\t\tmargin-right: auto;\n\t\t\t\tmin-width: 5em;\n\t\t\t}\n\t\t\t.search-controls {\n\t\t\t\tmargin-right: 0.5em;\n\t\t\t\tmargin-left: 1em;\n\t\t\t\tfont-family: system-ui, monospace;\n\t\t\t\tfont-size: 1.1em;\n\t\t\t\tuser-select: none;\n\t\t\t}\n\t\t\t.search-controls span {\n\t\t\t\tmin-width: 1.4em;\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttext-align: center;\n\t\t\t}\n\t\t\t#file-search ::placeholder {\n\t\t\t\tcolor: var(--main-theme-text-invert-color);\n\t\t\t}\n\t\t</style>\n\t\t<div class="collapse-handle">></div>\n\t\t<div class="search-field">\n\t\t\t<input\n\t\t\t\ttype="text"\n\t\t\t\tautocomplete="off"\n\t\t\t\tautocorrect="off"\n\t\t\t\tautocapitalize="off"\n\t\t\t\tspellcheck="false"\n\t\t\t\tplaceholder="Find"\n\t\t\t/>\n\t\t</div>\n\t\t<div class="search-count hidden">\n\t\t\t<span class="search-count-current">X</span>\n\t\t\t<span>of</span>\n\t\t\t<span class="search-count-total">Y</span>\n\t\t</div>\n\t\t<span class="search-no-results">No results</span>\n\t\t<div class="search-controls">\n\t\t\t<span class="search-up">↑</span>\n\t\t\t<span class="search-down">↓</span>\n\t\t\t<span class="search-close">X</span>\n\t\t</div>\n\t',t};function attachGutterHelper(t){const e=()=>Array.from(document.querySelectorAll(".CodeMirror-sizer")),n=()=>t||document.body.querySelector(".CodeMirror-gutters");let r,o,i=n();const a=()=>{const t=e();t.length&&(t.forEach((t=>t.classList.remove("gutter-hovered"))),o=!1)};document.body.addEventListener("mouseover",(t=>{if(i=n(),!i)return a();const{className:s="",classList:c}=t.target;return r=i.contains(t.target)||c.contains("CodeMirror-gutters")||c.contains("gutter-elt")||c.contains("guttermarker")||s.includes&&s.includes("CodeMirror-guttermarker"),r&&!o?(()=>{const t=e();t.length&&(t.forEach((t=>t.classList.add("gutter-hovered"))),o=!0)})():!r&&o?a():void 0}),{passive:!0,capture:!1})}const{indentWithTabs:indentWithTabs,tabSize:tabSize}=getSettings();let editorGutter,cmDom,prevDoc;const BLANK_CODE_PAGE="",InlineEditor=(t,e,n)=>({code:r=BLANK_CODE_PAGE,line:o,column:i,name:a,id:s,filename:c,path:l,callback:d}={})=>{let u=document.querySelector("#editor-container");if(!u){const t=Container();u=document.createElement("div"),u.id="editor-container",u.innerHTML=`\n\t\t\t<div id="service-fields" class="row no-margin">\n\t\t\t\t<div class="input-field col s6">\n\t\t\t\t\t<input id="service_name" type="text" class="" value="${a}">\n\t\t\t\t\t<label for="service_name">Name</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="input-field col s6">\n\t\t\t\t\t<input id="service_id" type="text" class="" value="${s}">\n\t\t\t\t\t<label for="service_id">ID</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,u.appendChild(e(a?[{name:a,active:!0}]:void 0)),u.appendChild(Search());const n=document.createElement("textarea");n.id="service_code",n.classList.add("functionInput"),n.classList.add("hidden"),u.appendChild(n),t.querySelector(".contain").appendChild(u)}window.M&&M.updateTextFields();const p="true"===window.localStorage.getItem("themeDark"),f=t({code:r,name:a,id:s,filename:c});var m,h=null;const v=t=>{const e=t.getCursor(),r=e.line+1,o=e.ch+1;!function(t,e){var n=t.getLineHandle(e-1);n==h&&e==m||(h&&t.removeLineClass(h,null,null),h=n,m=e,t.addLineClass(h,null,"activeline"))}(t,r),n({line:r,column:o})},g=(t,e)=>{},y=codemirrorModeFromFileType(getFileType(c));function b(t){var e=CodeMirror.Pos,n=t.getCursor("from"),r=t.getCursor("to"),o=t.state.sublimeFindFullWord==t.doc.sel;if(0==CodeMirror.cmpPos(n,r)){var i=wordAt(t,n);if(!i.word)return;t.setSelection(i.from,i.to),o=!0}else{var a=t.getRange(n,r),s=o?new RegExp("\\b"+a+"\\b"):a,c=t.getSearchCursor(s,r),l=c.findNext();if(l||(l=(c=t.getSearchCursor(s,e(t.firstLine(),0))).findNext()),!l||function(t,e,n){for(var r=0;r<t.length;r++)if(0==CodeMirror.cmpPos(t[r].from(),e)&&0==CodeMirror.cmpPos(t[r].to(),n))return!0;return!1}(t.listSelections(),c.from(),c.to()))return;t.addSelection(c.from(),c.to())}return o&&(t.state.sublimeFindFullWord=t.doc.sel),!1}const w={"Cmd-D":b,"Ctrl-D":b,"Ctrl-/":function(t){t.toggleComment({indent:!0})},"Alt-Up":function(t){var e=CodeMirror.Pos;if(t.isReadOnly())return CodeMirror.Pass;for(var n=t.listSelections(),r=[],o=t.firstLine()-1,i=[],a=0;a<n.length;a++){var s=n[a],c=s.from().line-1,l=s.to().line;i.push({anchor:e(s.anchor.line-1,s.anchor.ch),head:e(s.head.line-1,s.head.ch)}),0!=s.to().ch||s.empty()||--l,c>o?r.push(c,l):r.length&&(r[r.length-1]=l),o=l}t.operation((function(){for(var n=0;n<r.length;n+=2){var o=r[n],a=r[n+1],s=t.getLine(o);t.replaceRange("",e(o,0),e(o+1,0),"+swapLine"),a>t.lastLine()?t.replaceRange("\n"+s,e(t.lastLine()),null,"+swapLine"):t.replaceRange(s+"\n",e(a,0),null,"+swapLine")}t.setSelections(i),t.scrollIntoView()}))},"Alt-Down":function(t){var e=CodeMirror.Pos;if(t.isReadOnly())return CodeMirror.Pass;for(var n=t.listSelections(),r=[],o=t.lastLine()+1,i=n.length-1;i>=0;i--){var a=n[i],s=a.to().line+1,c=a.from().line;0!=a.to().ch||a.empty()||s--,s<o?r.push(s,c):r.length&&(r[r.length-1]=c),o=c}t.operation((function(){for(var n=r.length-2;n>=0;n-=2){var o=r[n],i=r[n+1],a=t.getLine(o);o==t.lastLine()?t.replaceRange("",e(o-1),e(o),"+swapLine"):t.replaceRange("",e(o,0),e(o+1,0),"+swapLine"),t.replaceRange(a+"\n",e(i,0),null,"+swapLine")}t.scrollIntoView()}))}},S=(t,e)=>{if(t)return console.error(t),void(d&&d(t));d&&d(),window.Editor=e,e.setOption("theme",p?"vscode-dark":"default"),e.setOption("styleActiveLine",{nonEmpty:!0}),e.setOption("extraKeys",w);const n=(t,e,n)=>{t.addLineClass(e.line,"wrap","folded")},r=(t,e,n)=>{t.removeLineClass(e.line,"wrap","folded")};e.on("fold",n),e.on("unfold",r),e.on("change",f),e.on("cursorActivity",v),e.on("scrollCursorIntoView",g),e._cleanup=()=>{e.off("change",f),e.off("cursorActivity",v),e.off("scrollCursorIntoView",g),e.off("fold",n),e.off("unfold",r);const t=document.querySelector(".cm-sidebar canvas");t&&(t.width=t.width)}},x={text:r||"",docStore:window.localforage,lineNumbers:!0,mode:y,addModeClass:!0,autocorrect:!0,tabSize:tabSize,indentWithTabs:indentWithTabs,smartIndent:!1,showInvisibles:!0,styleActiveLine:!0,styleActiveSelected:!0,matchBrackets:!0,lineWrapping:!1,scrollPastEnd:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],foldOptions:{widget:(t,e)=>"...",minFoldSize:3},miniMap:!0,miniMapSide:"right",miniMapWidth:64,cursorBlinkRate:0},E=()=>{console.log(`%c${c}: %ceditor %cloadDoc start`,"color:#CE9178;","color:#9CDCFE;","color:#DCDCAA;");const t=prevDoc!==c;cmDom=cmDom||document.querySelector(".CodeMirror"),editorGutter=editorGutter||document.body.querySelector(".CodeMirror-gutters"),t&&(cmDom.style.opacity=0);const{text:e}=x;window.Editor._cleanup&&window.Editor._cleanup();const n=t=>{t||(S(null,window.Editor),cmDom.style.opacity=1,prevDoc=c)};if(!l||!c)return n();window.Editor.loadDoc({name:c,path:l,line:o?Number(o):0,ch:i?Number(i):0,text:e,mode:y,callback:n})};if(window.Editor)return E();allTheEditorThings({...x,text:"\n\n\n"},((t,e)=>{if(t)return console.error(t),void(d&&d(t));window.Editor=e,E()}))};let nothingOpen$1;attachGutterHelper(editorGutter);const showNothingOpen=()=>{try{document.getElementById("file-search").style.visibility=""}catch(t){}if(!nothingOpen$1){const t=document.getElementById("editor-container");nothingOpen$1=document.createElement("div"),nothingOpen$1.id="editor-empty",t.appendChild(nothingOpen$1)}return nothingOpen$1.innerHTML='\n\t\t<style>\n\t\t\t#editor-empty {\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 0;\n\t\t\t\tright: 0;\n\t\t\t\ttop: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tbackground: #1e1e1e;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\toverflow: hidden;\n\t\t\t\tmin-width: 160px;\n\t\t\t\tz-index: 11;\n\t\t\t}\n\t\t\t#editor-empty-logo {\n\t\t\t\topacity: .7;\n\t\t\t\tcolor: rgb(var(--main-theme-highlight-color));\n\t\t\t\tfill: currentColor;\n\t\t\t\twidth: 18em;\n\t\t\t\tmargin-top: -14em;\n\t\t\t\tstroke: rgba(var(--main-theme-highlight-color),.4);\n\t\t\t}\n\t\t\t.editor-empty-blurb {\n\t\t\t\t/* visibility: hidden; */\n\t\t\t\tfont-variant: small-caps;\n\t\t\t\tfont-style: italic;\n\t\t\t\tcolor: var(--main-theme-text-color);\n\t\t\t}\n\t\t</style>\n\t\n\t<svg viewBox="-4 -4 172 150" id="editor-empty-logo">\n\t\t<g>\n\t\t\t<title>Do or do not.  There is no try.</title>\n\t\t\t<path d="m0.66613,141.12654l40.94759,-22.96759l39.55286,22.95911l-80.50045,0.00848z" stroke="#000000" stroke-width="0" opacity=".3" style="fill: black;opacity: .15;"></path>\n\t\t\t<path d="m81.32664,141.18317l41.77172,-23.74405l40.66986,23.45933l-82.44158,0.28472z" stroke-width="0" opacity=".1" style="fill: black;opacity: .15;"></path>\n\t\t\t<path d="m-8.80672,124.5856l39.68109,-24.32103l39.94988,23.98956l-79.63097,0.33147z" stroke-width="0" transform="rotate(120.005 31.0088 112.425)" opacity=".15" style="fill: black;opacity: .5;"></path>\n\t\t\t<path d="m29.8517,54.08169l40.95021,-23.76637l41.15387,23.42957l-82.10408,0.3368z" stroke-width="0" transform="rotate(120.005 70.9037 42.1985)" opacity=".15" style="fill: black;opacity: .5;"></path>\n\t\t\t<path d="m50.84794,54.21713l41.14723,-23.71165l40.66986,23.126l-81.81709,0.58565z" stroke-width="0" transform="rotate(240.005 91.7565 42.3613)" opacity=".6" style="fill: black;opacity: .6;"></path>\n\t\t\t<path d="m92.34289,123.94524l40.84106,-24.40053l40.54568,23.11973l-81.38674,1.2808z" stroke-width="0" transform="rotate(240.005 133.036 111.745)" opacity=".35" style="fill: black;opacity: .67;"></path>\n\n\t\t\t<path id="border" d="m80.7229,0.44444l82.61043,140.55521l-163.22223,0.44479l80.6118,-141z" fill="none" stroke-width="1" style="fill: transparent;stroke: transparent;"></path>\n\n\t\t\t<path d="m80.63317,96.1755l0.39079,45.37696l41.8002,-23.91294l-0.6859,-46.06544l-41.50509,24.60142z" stroke-width="0" opacity=".25" style="fill: black;opacity: .41;"></path>\n\t\t\t<path d="m60.24695,60.10716l0.41626,47.48081l41.25377,-23.26463l-0.93192,-47.77411l-40.73811,23.55793z" stroke-width="0" transform="rotate(60 81.082 72.0686)" opacity=".67" style="fill: aliceblue;opacity: .01;"></path>\n\t\t\t<path d="m41.52036,94.93062l-0.5376,46.74648l39.55956,-24.26797l-0.06849,-45.66349l-38.95347,23.18498z" stroke-width="0" transform="rotate(120 60.7625 106.711)" style="fill: black;opacity: .25;"></path>\n\t\t</g>\n\t</svg>\n\t<div class="editor-empty-blurb"><p>All models are wrong.</p><p style="margin-top:-10px;">Some models are useful.</p></div>',nothingOpen$1};let binaryPreview;const showBinaryPreview=({filename:t,path:e="."}={})=>{try{document.getElementById("file-search").style.visibility=""}catch(t){}if(!binaryPreview){const t=document.getElementById("editor-container");binaryPreview=document.createElement("div"),binaryPreview.id="editor-preview",t.appendChild(binaryPreview)}const n=getState$1();let r;try{r=n.paths.find((e=>e.name===t)).path.replace("/welcome/","/.welcome/").replace(/^\//,"./")}catch(t){}const o=getExtension(t),i=getFileType(t),a="\n\t\t<style>\n\t\t\t#editor-preview {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding-bottom: 30%;\n\t\t\t\tfont-size: 2em;\n\t\t\t\tcolor: var(--main-theme-text-invert-color);\n\t\t\t}\n\t\t\t#editor-preview .preview-image {\n\t\t\t\tmin-width: 50%;\n\t\t\t\timage-rendering: pixelated;\n\t\t\t\tobject-fit: contain;\n\t\t\t\tmargin-bottom: -20%;\n\t\t\t\tpadding: 0.7em;\n\t\t\t}\n\t\t\taudio {\n\t\t\t\tfilter: invert(0.7) contrast(1.5);\n\t\t\t}\n\t\t\taudio:focus {\n\t\t\t\toutline: 0;\n\t\t\t\tborder: 1px solid #444;\n\t\t\t\tborder-radius: 50px;\n\t\t\t}\n\t\t\tvideo {\n\t\t\t\tmax-width: 95%;\n\t\t\t}\n\t\t\t.image-disclaim {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 40px;\n\t\t\t\tpadding: .1em 1em;\n\t\t\t\tfont-size: 0.55em;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tjustify-content: start;\n\t\t\t\talign-items: start;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t#editor-preview pre {\n\t\t\t\tfont-size: 0.72em;\n\t\t\t\topacity: 0.7;\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\twhite-space: pre-line;\n\t\t\t}\n\t\t</style>\n\t";return binaryPreview.innerHTML="audio"===i?`\n\t\t<style>\n\t\t\t#editor-preview {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding-bottom: 30%;\n\t\t\t\tfont-size: 2em;\n\t\t\t\tcolor: var(--main-theme-text-invert-color);\n\t\t\t}\n\t\t\t#editor-preview .preview-image {\n\t\t\t\tmin-width: 50%;\n\t\t\t\timage-rendering: pixelated;\n\t\t\t\tobject-fit: contain;\n\t\t\t\tmargin-bottom: -20%;\n\t\t\t\tpadding: 0.7em;\n\t\t\t}\n\t\t\taudio {\n\t\t\t\tfilter: invert(0.7) contrast(1.5);\n\t\t\t}\n\t\t\taudio:focus {\n\t\t\t\toutline: 0;\n\t\t\t\tborder: 1px solid #444;\n\t\t\t\tborder-radius: 50px;\n\t\t\t}\n\t\t\tvideo {\n\t\t\t\tmax-width: 95%;\n\t\t\t}\n\t\t\t.image-disclaim {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 40px;\n\t\t\t\tpadding: .1em 1em;\n\t\t\t\tfont-size: 0.55em;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tjustify-content: start;\n\t\t\t\talign-items: start;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t#editor-preview pre {\n\t\t\t\tfont-size: 0.72em;\n\t\t\t\topacity: 0.7;\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\twhite-space: pre-line;\n\t\t\t}\n\t\t</style>\n\t\n\t\t\t<figure>\n\t\t\t<audio\n\t\t\t\tcontrols\n\t\t\t\tloop\n\t\t\t\tautoplay\n\t\t\t\tcontrolsList="play timeline volume"\n\t\t\t\tsrc="${r}"\n\t\t\t>\n\t\t\t\tYour browser does not support the\n\t\t\t\t<code>audio</code> element.\n\t\t\t</audio>\n\t\t\t</figure>\n\t\t`:"video"===i?`\n\t\t<style>\n\t\t\t#editor-preview {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding-bottom: 30%;\n\t\t\t\tfont-size: 2em;\n\t\t\t\tcolor: var(--main-theme-text-invert-color);\n\t\t\t}\n\t\t\t#editor-preview .preview-image {\n\t\t\t\tmin-width: 50%;\n\t\t\t\timage-rendering: pixelated;\n\t\t\t\tobject-fit: contain;\n\t\t\t\tmargin-bottom: -20%;\n\t\t\t\tpadding: 0.7em;\n\t\t\t}\n\t\t\taudio {\n\t\t\t\tfilter: invert(0.7) contrast(1.5);\n\t\t\t}\n\t\t\taudio:focus {\n\t\t\t\toutline: 0;\n\t\t\t\tborder: 1px solid #444;\n\t\t\t\tborder-radius: 50px;\n\t\t\t}\n\t\t\tvideo {\n\t\t\t\tmax-width: 95%;\n\t\t\t}\n\t\t\t.image-disclaim {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 40px;\n\t\t\t\tpadding: .1em 1em;\n\t\t\t\tfont-size: 0.55em;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tjustify-content: start;\n\t\t\t\talign-items: start;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t#editor-preview pre {\n\t\t\t\tfont-size: 0.72em;\n\t\t\t\topacity: 0.7;\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\twhite-space: pre-line;\n\t\t\t}\n\t\t</style>\n\t\n\t\t\t<video\n\t\t\t\tcontrols\n\t\t\t\tloop\n\t\t\t\tautoplay\n\t\t\t\tcontrolsList="play timeline volume"\n\t\t\t\tdisablePictureInPicture\n\t\t\t>\n\t\t\t\t<source\n\t\t\t\t\tsrc="${r}"\n\t\t\t\t\ttype="video/${o}"\n\t\t\t\t>\n\t\t\t\tSorry, your browser doesn't support embedded videos.\n\t\t\t</video>\n\t\t`:a+"\n\t\t\t<pre>No editable text for this file type.</pre>\n\t\t",binaryPreview},miscSystemSettings=[{name:"exit-current-service",description:"Close the current project",button:"close",onclick:"localStorage.setItem('lastService', ''); document.location.reload()"}],SystemDocs=(t,e)=>{if(!t){return htmlToElement('\n\t\t\t<div id="editor-system-doc">\n\t\t\t\t\n\t<style>\n\t\t#editor-system-doc {\n\t\t\tfont-size: inherit;\n\t\t\tmargin: 0;\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tjustify-content: start;\n\t\t\talign-items: center;\n\t\t\theight: 100%;\n\t\t\toverflow: auto;\n\t\t\twidth: 100%;\n\t\t\tpadding-bottom: 100px;\n\t\t\tpadding-right: 1em;\n\t\t\tpadding-left: 1em;\n\t\t\tbox-sizing: border-box;\n\t\t}\n\t\t#editor-system-doc::-webkit-scrollbar { width: 5px; height: 5px; }\n\t\t#editor-system-doc::-webkit-scrollbar-corner,\n\t\t#editor-system-doc::-webkit-scrollbar-track { background: transparent; }\n\t\t#editor-system-doc:hover::-webkit-scrollbar-thumb { background: #333; }\n\t\t#editor-system-doc::-webkit-scrollbar-thumb { background: transparent; }\n\t\t#editor-system-doc ::placeholder { opacity: 0.35; }\n\n\t\t#editor-system-doc h1 {\n\t\t\tfont-size: 1.1em;\n\t\t\tfont-variant: all-petite-caps;\n\t\t\tborder-bottom: 1px solid;\n\t\t\tpadding-bottom: .4em;\n\t\t\topacity: .55;\n\t\t\tmargin: 2.2em 0 0.5em 0;\n\t\t}\n\t\t.thisSystemDoc {\n\t\t\tmax-width: 60em;\n\t\t}\n\t\t.settings-grid-2-col {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: 1fr auto;\n\t\t\tgrid-auto-rows: auto;\n\t\t\talign-items: center;\n\t\t\tmargin: 1.5em 0;\n\t\t\tgrid-gap: 1em;\n\t\t\tbackground: #8888881f;\n\t\t\tpadding: 1.1em;\n\t\t\tborder-radius: 2px;\n\t\t}\n\t\t#editor-system-doc button {\n\t\t\tbackground: #88888847;\n\t\t\tborder: 0;\n\t\t\tpadding: 0.5em;\n\t\t\tcolor: inherit;\n\t\t\tmargin: .3em 0;\n\t\t}\n\t\t#editor-system-doc button:hover {\n\t\t\tbackground: rgba(var(--main-theme-highlight-color), 0.4);\n\t\t}\n\t\t#editor-system-doc ul {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n\t\t}\n\t\t#editor-system-doc li {\n\t\t\tmargin: 1em;\n\t\t\twidth: 100%;\n\t\t\ttext-align: center;\n\t\t\tbackground: #88888826;\n\t\t}\n\t\t#editor-system-doc form.provider-settings {\n\t\t\tpadding: 1em;\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tmargin-top: 1em;\n\t\t}\n\t\t#editor-system-doc input {\n\t\t\tcolor: inherit;\n\t\t\tmargin-bottom: 1.5em;\n\t\t\tbackground: #88888829;\n\t\t\tmargin-top: 0.3em;\n\t\t\tpadding: 0 .5em;\n\t\t\tbox-sizing: border-box;\n\t\t}\n\t\t.provider-settings button.error {\n\t\t\toutline: 1px solid red;\n\t\t\tbackground: red;\n\t\t\tcolor: red;\n\t\t}\n\t\t#settings-all-services-list li {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\tpadding: 1em;\n\t\t\talign-items: center;\n\t\t}\n\t\t#settings-all-services-list {\n\t\t\t/*min-height: 400px;*/\n\t\t\tjustify-content: flex-start;\n\t\t}\n\t</style>\n\t\n\t\t\t\t<div class="thisSystemDoc"></div>\n\t\t\t</div>\n\t\t'.replace(/		/g,""))}const n=`\n\t\t<h1>Misc Settings</h1>\n\n\t\t${miscSystemSettings.map((t=>`\n\t\t\t\t<div class="settings-grid-2-col">\n\t\t\t\t\t<div>${t.description}</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button id="${t.name}" onclick="${t.onclick}">${t.button}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`.replace(/				/g,""))).join("\n")}\n\t`.replace(/		/g,""),r="\n\t\t<h1>Add Folder</h1>\n\t\t<p>\n\t\t\tTODO: this functionality will take back seat to service provider because it's a one-shot/one-way solution;\n\t\t\tit's useful, but not as useful.\n\t\t</p>\n\t".replace(/		/g,""),o='\n\t\t<h1>Open Previous Service</h1>\n\t\t<p>\n\t\t\tShow a list of services each with button that sets lastService and does document reload\n\t\t</p>\n\t\t<ul id="settings-all-services-list">\n\t\t\t<li></li>\n\t\t</ul>\n\t'.replace(/		/g,""),i='\n\t\t<h1>Connect a Service Provider</h1>\n\t\t<p>\n\t\t\tTODO: show a list of providers and allow setup\n\t\t\tAt first, only local file server (electron), aka basic server, will be available\n\t\t\tIn the future, this could be a much long list of providers.\n\t\t\tTODO: get list of currently registered providers and show here (remove default value for basic server)\n\t\t</p>\n\t\t<ul>\n\t\t\t<li>\n\t\t\t\t<button\n\t\t\t\t\tonclick="event.target.parentNode.querySelector(\'.provider-settings\').classList.toggle(\'hidden\')"\n\t\t\t\t>Github</button>\n\t\t\t\t<form class="provider-settings" autocomplete="off" onsubmit="return false;">\n\t\t\t\t\t<input class="hidden" autocomplete="false" name="hidden" type="text">\n\t\t\t\t\t<input name="provider-type" class="hidden" type="text" value="github-provider">\n\n\t\t\t\t\t<label>Personal Access Token</label>\n\t\t\t\t\t<input name="provider-access-token" type="text" >\n\n\t\t\t\t\t<button class="provider-test">Test Provider</button>\n\t\t\t\t\t<button class="provider-save">Save Provider</button>\n\n\t\t\t\t\t<label style="margin-top: 30px;">Repository</label>\n\t\t\t\t\t<input type="text"\n\t\t\t\t\t\tname="provider-repository"\n\t\t\t\t\t\tvalue="crosshj/fiug-welcome"\n\t\t\t\t\t\tplaceholder="{user}/{repository name}"\n\t\t\t\t\t>\n\t\t\t\t\t<input type="text"\n\t\t\t\t\t\tname="provider-repository-branch"\n\t\t\t\t\t\tvalue="main"\n\t\t\t\t\t\tplaceholder="branch name"\n\t\t\t\t\t>\n\t\t\t\t\t<button class="provider-add-service">Add Repository</button>\n\t\t\t\t</form>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<button\n\t\t\t\t\tonclick="event.target.parentNode.querySelector(\'.provider-settings\').classList.toggle(\'hidden\')"\n\t\t\t\t>Bartok Basic Server</button>\n\t\t\t\t<form class="provider-settings" autocomplete="off" onsubmit="return false;">\n\t\t\t\t\t<input class="hidden" autocomplete="false" name="hidden" type="text">\n\t\t\t\t\t<input name="provider-type" class="hidden" type="text" value="basic-bartok-provider">\n\n\t\t\t\t\t<label>Server URL</label>\n\t\t\t\t\t<input name="provider-url" type="text" value="http://localhost:3333/">\n\n\t\t\t\t\t<button class="provider-test">Test Provider</button>\n\t\t\t\t\t<button class="provider-save">Save Provider</button>\n\t\t\t\t\t<button class="provider-add-service">Add Folder</button>\n\t\t\t\t</form>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<button\n\t\t\t\t\tonclick="event.target.parentNode.querySelector(\'.provider-settings\').classList.toggle(\'hidden\')"\n\t\t\t\t>Bartok Advanced Server</button>\n\t\t\t\t<form class="provider-settings hidden" autocomplete="off" onsubmit="return false;">\n\t\t\t\t\t<input class="hidden" autocomplete="false" name="hidden" type="text">\n\t\t\t\t\t<input name="provider-type" class="hidden" type="text" value="basic-advanced-provider">\n\n\t\t\t\t\t<label>Server URL</label>\n\t\t\t\t\t<input name="provider-url" type="text" >\n\n\t\t\t\t\t<button class="provider-test">Test Provider</button>\n\t\t\t\t\t<button class="provider-save">Save Provider</button>\n\t\t\t\t\t<button class="provider-add-service">Add Folder</button>\n\t\t\t\t</form>\n\t\t\t</li>\n\t\t</ul>\n\t'.replace(/		/g,"");return{"add-service-folder":r,"connect-service-provider":i,"open-previous-service":o,"open-settings-view":`\n\t\t${i}\n\t\t${r}\n\t\t${o}\n\t\t${n}\n\t`.replace(/		/g,"")}[t]||""};let systemDocsDOM;const showSystemDocsView=({filename:t="",op:e=""},n)=>{const{systemDocsErrors:r}=n;try{document.getElementById("file-search").style.visibility=""}catch(t){}if(!systemDocsDOM){const t=document.getElementById("editor-container");systemDocsDOM=SystemDocs(),t.appendChild(systemDocsDOM)}t&&(systemDocsDOM.querySelector(".thisSystemDoc").innerHTML=SystemDocs(t));const o=document.getElementById("settings-all-services-list");return(async()=>{if(!o)return;o.innerHTML="<li>loading...</li>";const t=await getAllServices()||[];o.innerHTML=t.map((t=>`\n\t\t\t<li>\n\t\t\t\t<span>[ ${t.id} ] ${t.name}</span>\n\t\t\t\t<button onclick="${(t=>[`localStorage.setItem('lastService','${t.id}');`,"document.location.reload();"].join(" "))(t)}">LOAD</button>\n\t\t\t</li>\n\t\t`.trim().replace(/^			/g,""))).join("\n")})(),r.length&&r.forEach((t=>{const e=systemDocsDOM.querySelector("."+t.op.replace("-done",""));e?e.classList.add("error"):console.error(t)})),systemDocsDOM};let editorDom,editorPreview,nothingOpenDom,systemDocsView;const switchEditor=async(t,{editor:e,context:n})=>{const{filename:r,mode:o,line:i,column:a}=t;if("systemDoc"===o){return e({code:"",name:"",id:"",filename:r,callback:()=>{editorDom=document.querySelector(".CodeMirror"),editorDom&&editorDom.classList.add("hidden")}}),systemDocsView=showSystemDocsView({filename:r},n),systemDocsView&&systemDocsView.classList.remove("hidden"),editorPreview&&editorPreview.classList.add("hidden"),void(nothingOpenDom&&nothingOpenDom.classList.add("hidden"))}if("nothingOpen"===o){return e({code:"",name:"",id:"",filename:"",callback:()=>{editorDom=document.querySelector(".CodeMirror"),editorDom&&editorDom.classList.add("hidden")}}),nothingOpenDom=showNothingOpen(),nothingOpenDom&&nothingOpenDom.classList.remove("hidden"),editorPreview&&editorPreview.classList.add("hidden"),editorDom&&editorDom.classList.add("hidden"),void(systemDocsView&&systemDocsView.classList.add("hidden"))}setCurrentFile({filePath:r});const s=await getCurrentFileFull(),{code:c="error",path:l,name:d,id:u,filename:p}=s||{};if(!s||!showFileInEditor(r)){return e({code:"",name:"",id:"",filename:"",callback:()=>{editorDom=document.querySelector(".CodeMirror"),editorDom&&editorDom.classList.add("hidden")}}),editorPreview=showBinaryPreview({filename:r,code:c}),editorPreview&&editorPreview.classList.remove("hidden"),editorDom&&editorDom.classList.add("hidden"),nothingOpenDom&&nothingOpenDom.classList.add("hidden"),void(systemDocsView&&systemDocsView.classList.add("hidden"))}e({code:c,line:i,column:a,name:d,id:u,path:l,filename:r||p}),editorDom=document.querySelector(".CodeMirror"),editorDom&&editorDom.classList.remove("hidden"),editorPreview&&editorPreview.classList.add("hidden"),nothingOpenDom&&nothingOpenDom.classList.add("hidden"),systemDocsView&&systemDocsView.classList.add("hidden")},messageEditor=(t,{editor:e,context:n})=>{const{op:r,result:o}=t;if(!o.error)return showSystemDocsView({op:r});n.systemDocsErrors=n.systemDocsErrors.filter((t=>t.op===r)),n.systemDocsErrors.push({op:r,error:o.error}),showSystemDocsView({errors:n.systemDocsErrors})},listeners$1={},triggers$1={};function attach({name:t,listener:e,eventName:n,options:r,key:o,context:i}){if(!t||!e||!n)return console.error("Attempt to improperly attach an event listener"),void console.error({name:t,listener:e,eventName:n});const a=`${n}__${t}`;if(listeners$1[a])return;window.addEventListener(n,(t=>e(t,i||{})),r),listeners$1[a]=e,o&&(listeners$1[a]._meta={key:o,name:t,eventName:n,options:r})}function list(){return Object.keys(listeners$1)}function trigger(t){const{e:e,type:n,params:r,source:o,data:i,detail:a}=t,s="function"==typeof i?i(e):i||(a||{}).data||{},c={...s,...r,source:o,data:s},l=a?{...c,...a,data:s}:c,d=new CustomEvent(n,{bubbles:!0,detail:l});window.dispatchEvent(d);const{e:u,...p}=t;["operationDone"].includes(n)||window.top.postMessage({triggerEvent:p},location)}let triggerClickListener;const attachTrigger=function({name:t,type:e="click",data:n,eventName:r,filter:o}){if("raw"===e){const o=e=>{trigger({...e,e:e,data:n,type:r,source:t})};return triggers$1[`${r}__${t}`]={eventName:r,type:e,trigger:o},o}if("click"!==e)return void console.error(`triggering based on ${e} not currently supported`);const i=triggerClickListener||(t=>{const e=Object.keys(triggers$1).map((t=>({key:t,...triggers$1[t]}))).find((e=>{if("raw"===e.type)return!1;return e.filter&&"function"==typeof e.filter&&e.filter(t)}));if(!e)return!0;t.preventDefault(),t.stopPropagation();const{eventName:n,data:r}=e,o="function"==typeof r?r(t):r||{};return trigger({type:n,params:{},source:{},data:o,detail:(o||{}).detail}),!1}),a={};triggerClickListener||window.addEventListener(e,i,a);triggers$1[`${r}__${t}`]={eventName:r,filter:o,data:n,type:e},triggerClickListener=triggerClickListener||i};function listTriggers$1(){return Object.keys(triggers$1)}function attachEvents(t,e){const n=flatFromProp(t.listeners,"handlers");for(const t of n)attach({...t,context:e});e.triggers={},e.triggerEvent={};Object.entries(t.triggers).map((([t,n])=>{const r=t.toLowerCase(),o=flatFromProp(n,"handlers").reduce(((e,{name:n,eventName:r,...o})=>{const i=attachTrigger({...o,name:t,eventName:r});return i?{...e,[n||r]:i}:e}),{});e.triggers[r]=o,e.triggerEvent[r]=(t,n)=>{e.triggers[r][t]({detail:{operation:n,done:()=>{},body:{}}})}}))}window.listTriggers=listTriggers$1,window.listListeners=list,window.addEventListener("message",(function(t){}),!1),await navigator.serviceWorker.ready,navigator.serviceWorker.controller.postMessage({type:"TEST_MESSAGE"});const fileSelectHandler=async(t,{getFilePath:e,switchEditor:n})=>{const{name:r,path:o,next:i,nextPath:a,parent:s}=t.detail,{line:c,column:l}=t.detail,d=e({name:r,parent:s,path:o,next:i,nextPath:a});r.includes("system::")||d.includes("systemDoc::")?n({filename:d.replace("system::","").replace("systemDoc::",""),mode:"systemDoc"}):n(r?{filename:d,line:c,column:l}:{mode:"nothingOpen"})},operationDoneHandler=(t,e)=>{const{messageEditor:n}=e,{detail:r}=t,{op:o,result:i}=r||{};if(["provider-test","provider-save","provider-add-service"].includes(o))n({op:o+"-done",result:i});else if(["read","update"].includes(o)){const t=i[0]?.state?.selected;fileSelectHandler({detail:t},e)}else;},fileClose=(t,{getCurrentFile:e,getFilePath:n,switchEditor:r})=>{const{name:o,parent:i,path:a,next:s,nextPath:c}=t.detail;if(!s)return void r({mode:"nothingOpen"});if(s.includes("system::"))return void r({filename:s.replace("system::",""),mode:"systemDoc"});if(s===e())return;r({filename:n({name:o,parent:i,path:a,next:s,nextPath:c})})},contextMenuHandler=(t,{triggers:e})=>{const n=document.querySelector("#editor .CodeMirror");if(!n)return!0;if(!n.contains(t.target))return!0;t.preventDefault();const r=["Cut","Copy","Paste","seperator","Command Palette"].map((t=>"seperator"===t?"seperator":{name:t,disabled:!1}));let o;try{o={}}catch(t){}if(o)return e.editor.contextMenuShow({detail:{x:t.clientX,y:t.clientY,list:r,parent:"Editor",data:o}}),!1;console.error("some issue finding data for this context click!")},paste=async()=>{window.Editor.focus();const t=await navigator.clipboard.readText();window.Editor.replaceSelection(t)},cutSelected=()=>{window.Editor.focus();const t=window.Editor.getSelection();navigator.clipboard.writeText(t),window.Editor.replaceSelection("")},copySelected=()=>{const t=window.Editor.getSelection();navigator.clipboard.writeText(t)},contextMenuSelectHandler=(t,{triggerEvent:e})=>{const{which:n,parent:r,data:o}=t.detail||{};if("Editor"!==r)return;const i={Cut:cutSelected,Copy:copySelected,Paste:paste,"Command Palette":()=>e("ui","commandPalette")}[n];if(!i)return console.error(`Unrecognized context menu command: ${n}`);i({parent:r,data:o})},serviceSwitchListener=async(t,{getCurrentFile:e,getCurrentService:n,switchEditor:r})=>{const o=e(),i=n({pure:!0}),a=i.code.find((t=>t.name===o));if(!a)return console.error(`[editor:serviceSwitch] Current service (${i.id}:${i.name}) does not contain file: ${o}`),void r(null,"nothingOpen");r(o,null,a.code)},test={data:t=>Array.from(t.target.parentNode.querySelectorAll('input:not([name="hidden"])')).map((({name:t,value:e})=>({name:t,value:e}))),filter:t=>document.querySelector("#editor").contains(t.target)&&t.target.classList.contains("provider-test")},save={data:t=>Array.from(t.target.parentNode.querySelectorAll('input:not([name="hidden"])')).map((({name:t,value:e})=>({name:t,value:e}))),filter:t=>document.querySelector("#editor").contains(t.target)&&t.target.classList.contains("provider-save")},addService={data:t=>Array.from(t.target.parentNode.querySelectorAll('input:not([name="hidden"])')).map((({name:t,value:e})=>({name:t,value:e}))),filter:t=>document.querySelector("#editor").contains(t.target)&&t.target.classList.contains("provider-add-service")};var provider={test:test,save:save,addService:addService};const nothingOpen=(t,{switchEditor:e})=>e(null,"nothingOpen"),systemDocs=(t,{switchEditor:e})=>e(t.type,"systemDoc");var editor={...formatHandlers("Editor",{operationDone:operationDoneHandler,fileSelect:fileSelectHandler,fileClose:fileClose,contextMenu:contextMenuHandler,contextMenuSelect:contextMenuSelectHandler,serviceSwitch:serviceSwitchListener,nothingOpen:nothingOpen,systemDocs:systemDocs}),provider:provider};const handler$e=(t,{tabs:e})=>{const{initTabs:n,createTab:r,updateTab:o,removeTab:i}=e.operations,{sysDocNames:a}=e;let s,{name:c,changed:l,parent:d,path:u}=event.detail;if(u&&(d=u),!d&&c?.includes("/")&&(d=c.split("/").slice(0,-1).join("/"),c=c.split("/").pop()),c?.includes("system::")&&e.update(tabsApi.list()||[]),!e.api.list())return;c?.includes("system::")&&(s=a[c.replace("system::","")]);let p="TAB"+Math.random().toString().replace("0.",""),{tabsToUpdate:f,foundTab:m}=e.api.toUpdate(d?`${d}/${c}`:c);if(m)return void f.map(o);r({name:c,parent:d,active:!0,id:p,changed:l});const h=!c.includes("Untitled-"),{cleared:v,tabs:g}=h&&e.api.clearLast({tabs:e,removeTab:i})||{};g&&(e=g),v&&(f=f.filter((t=>t.id!==v.id))),f.map(o),e.api.push({name:c,parent:d,systemDocsName:s,active:!0,id:p,changed:l})};function removeTabByEventDetail({removeTab:t,updateTab:e},n,r){let{name:o,filename:i,path:a,parent:s,next:c,nextPath:l}=n;o=o||i,a=a||s;const d=getCurrentService();!a&&o?.includes("/")&&(a=o.split("/").slice(0,-1).join("/"),o=o.split("/").pop()),!l&&c?.includes("/")&&(l=c.split("/").slice(0,-1).join("/"),c=c.split("/").pop());let u=a?`${a}/${o}`:o;d?.name&&new RegExp("^"+d.name).test(u)&&(u=u.replace(d.name+"/",""));const p=t=>t.parent?`${t.parent}/${t.name}`:t.name,f=r.api.find((t=>p(t)===u));if(f){if(r.api.update(r.api.list().filter((t=>p(t)!=u))),c||!r.api.find((t=>t.active))){const t=c&&r.api.find((t=>t.name===c&&t.parent===l||t.systemDocsName===c))||r[r.length-1];t&&(t.active=!0,e(t))}t(f)}}const handler$d=(t,{tabs:e})=>{const{removeTab:n,updateTab:r}=e.operations;removeTabByEventDetail({removeTab:n,updateTab:r},event.detail,e)},handler$c=(t,n)=>{const{tabs:r}=n;r.operations;const{operation:o}=t.detail||{};o&&["deleteFile"].includes(o)&&("deleteFile"!==o||handler$d(e,n))},handler$b=(t,e)=>{const{tabs:n}=e,{initTabs:r,createTab:o,updateTab:i,removeTab:a}=n.operations,{op:s,id:c,result:l=[]}=event.detail||{};if(l?.error)return;if(!["read","update"].includes(s)||!c)return;const{opened:d=[],changed:u=[]}=l[0]?.state||{};let p=d.map((({name:t,order:e})=>({id:"TAB"+Math.random().toString().replace("0.",""),name:t.split("/").pop(),parent:t.split("/").slice(0,-1).join("/"),touched:u.includes(t),changed:u.includes(t),active:0===e})));n.api.update(p),r(p,e)},handler$a=(t,{tabs:e})=>{const{initTabs:n,createTab:r,updateTab:o,removeTab:i}=e.operations,{filePath:a}=event.detail,{foundTab:s}=e.api.toUpdate(a);s?(s.changed=!0,[s].map(o)):console.error(`Could not find a tab named ${a} to update`)},handler$9=(t,{triggers:e,tabs:n})=>{if(!document.querySelector("#editor-tabs-container").contains(t.target))return!0;t.preventDefault();const r=!("editor-tabs"===t.target.id)&&t.target.classList.contains("tab")?t.target:void 0,o=r&&r.id,i=r&&n.api.find((t=>t.id===o)),a=(i?n.length>1?["Close",{name:"Close Others"},{name:"Close All"},"-------------------","Copy Path","Copy Relative Path"]:["Close","-------------------","Copy Path","Copy Relative Path"]:[{name:"Close All"}]).map((t=>"-------------------"===t?"seperator":"string"==typeof t?{name:t,disabled:!1}:t));let s;try{s={tab:i}}catch(t){}if(s)return e.tabs.contextMenuShow({detail:{x:t.clientX,y:t.clientY,list:a,parent:"Tab Bar",data:s}}),!1;console.error("some issue finding data for this context click!")};function copyPath(t,e){const n=getState(),{name:r}=t;let o;try{o=n.paths.find((t=>t.name===r)).path.replace("/welcome/","/.welcome/").replace(/^\//,"./")}catch(t){}if(!o)return void console.log("TODO: make Copy Path work with folders!");const i=e?o:new URL(o,document.baseURI).href;navigator.clipboard.writeText(i).then((t=>console.log(`Wrote path to clipboard: ${i}`))).catch((t=>{console.error(`Error writing path to clipboard: ${i}`),console.error(t)}))}const handler$8=(t,{tabs:e})=>{const{triggers:n}=e,{which:r,parent:o,data:i}=t.detail||{};if("Tab Bar"!==o)return;const a=t=>()=>setTimeout((()=>alert(t+": not implemented")),0),s={close:({tab:t})=>n.fileClose({detail:t}),closeothers:n.closeOthers,closeall:n.closeAll,copypath:({tab:t})=>copyPath(t),copyrelativepath:({tab:t})=>copyPath(t,"relative"),revealinsidebar:({tab:t})=>{n.fileSelect({detail:t}),document.getElementById("explorer").focus()},keepopen:a("keepopen"),pin:a("pin")}[r.toLowerCase().replace(/ /g,"")];s&&s(i)},handler$7=(t,{tabs:e})=>{e.operations;const{detail:n}=event,{operation:r}=n,o={prevDocument:()=>{console.warn("prevDocument: not implemented!")},nextDocument:()=>{console.warn("nextDocument: not implemented!")}}[r];o&&o()};function triggerCloseTab(t,e,n){let r,o;try{r=t.target.dataset.name.trim(),o=(t.target.dataset.parent||"").trim()}catch(t){console.log("error trying to handle close tab click"),console.log(t)}if(!r)return;const i=o?`${o}/${r}`:r,a=t=>t.parent?`${t.parent}/${t.name}`:t.name,s=n.find((t=>i===a(t))),c=n.filter((t=>i!==a(t))),l=s.active?c[c.length-1]||{}:(n.filter((t=>t.active))||[{}])[0];e({detail:{name:s.name,path:s.parent,next:l.name,nextPath:l.parent}})}const handler$6=(t,e)=>{const{tabs:n,triggers:r}=e;if(!n.contains(event.target))return;if(!event.target.classList.contains("tab")&&!event.target.classList.contains("close-editor-action"))return;if(event.target.classList.contains("close-editor-action"))return triggerCloseTab(event,r.tabs.fileClose,n.api.list()),void event.preventDefault();const o=event.target.id,i=n.api.list().find((t=>t.id===o));if(n.api.list().filter((t=>t.active)).map((t=>t.id)).includes(o))return;const a=getCurrentService();r.tabs.fileSelect({detail:{name:i.name,path:i.parent,parent:i.parent,service:a?a.name:""}},e)},handler$5=(t,e)=>{const n={detail:{name:"system::"+t.type}};handler$e(n,e)},closeAll={data:t=>({})},closeOthers={data:t=>({})};var closeMultiple={closeAll:closeAll,closeOthers:closeOthers},tabs={...formatHandlers("Tabs",{operations:handler$c,operationDone:handler$b,fileSelect:handler$e,fileClose:handler$d,fileChange:handler$a,contextMenu:handler$9,contextMenuSelect:handler$8,ui:handler$7,click:handler$6,systemDocs:handler$5,closeMultiple:closeMultiple})};const handler$4=(t,e)=>{const{status:n}=e,{setLineNumber:r,setColNumber:o,setTabSize:i,setDocType:a}=n.operations,{detail:s}=t,{line:c,column:l}=s;r(c),o(l)},handler$3=(t,e)=>{const{status:n}=e;n.operations},handler$2=(t,e)=>{const{status:n}=e,{setLineNumber:r,setColNumber:o,setTabSize:i,setDocType:a}=n.operations,{detail:s}=t,{name:c}=s;if(!c)return;const l=getFileType(c);a(friendlyModeName(l,codemirrorModeFromFileType(l))),r(1),o(1)},handler$1=(t,e)=>{const{status:n}=e;n.operations},handler=(t,e)=>{const{status:n}=e,{setLineNumber:r,setColNumber:o,setTabSize:i,setDocType:a}=n.operations,{detail:s}=t,{op:c,id:l,result:d}=s;if("read"!==c||!l)return;const u=d[0]?.state?.selected,p=getFileType(u.name);a(friendlyModeName(p,codemirrorModeFromFileType(p))),r(1),o(1)};var status={...formatHandlers("Status",{cursorActivity:handler$4,fileChange:handler$3,fileSelect:handler$2,fileClose:handler$1,operationDone:handler})};const listeners=[{eventName:"service-switch-notify",handlers:[editor.serviceSwitch]},{eventName:"cursorActivity",handlers:[status.cursorActivity]},{eventName:"operationDone",handlers:[editor.operationDone,tabs.operationDone,status.operationDone]},{eventName:"operations",handlers:[tabs.operationDone]},{eventName:"open-settings-view",handlers:[editor.systemDocs,tabs.fileSelect]},{eventName:"add-service-folder",handlers:[editor.systemDocs,tabs.fileSelect]},{eventName:"open-previous-service",handlers:[editor.systemDocs,tabs.fileSelect]},{eventName:"connect-service-provider",handlers:[editor.systemDocs,tabs.fileSelect]},{eventName:"noServiceSelected",handlers:[editor.nothingOpen]},{eventName:"fileSelect",handlers:[editor.fileSelect,tabs.fileSelect,status.fileSelect]},{eventName:"fileClose",handlers:[editor.fileClose,tabs.fileClose,status.fileClose]},{eventName:"fileChange",handlers:[tabs.fileChange,status.fileChange]},{eventName:"contextmenu",handlers:[{...editor.contextMenu,options:{capture:!0}},{...tabs.contextMenu,options:{capture:!0}}]},{eventName:"contextmenu-select",handlers:[editor.contextMenuSelect,tabs.contextMenuSelect]},{eventName:"ui",handlers:[tabs.ui]},{eventName:"click",handlers:[tabs.click]}],triggers={Editor:[{eventName:"ui",type:"raw"},{eventName:"fileClose",type:"raw"},{eventName:"fileSelect",type:"raw"},{eventName:"contextMenuShow",type:"raw"},{eventName:"provider-test",type:"click",handlers:[editor.provider.test]},{eventName:"provider-save",type:"click",handlers:[editor.provider.save]},{eventName:"provider-add-service",type:"click",handlers:[editor.provider.addService]}],Tabs:[{eventName:"ui",type:"raw"},{eventName:"fileClose",type:"raw"},{eventName:"fileSelect",type:"raw"},{eventName:"contextMenuShow",type:"raw"},{name:"addFileUntracked",eventName:"operations",type:"raw",data:{operation:"addFile",untracked:!0}}],Status:[{eventName:"ui",type:"raw"},{eventName:"fileClose",type:"raw"},{eventName:"fileSelect",type:"raw"}]};var events={listeners:listeners,triggers:triggers};const CursorActivityHandler=({line:t,column:e})=>{const n=new CustomEvent("cursorActivity",{bubbles:!0,detail:{line:t,column:e}});document.body.dispatchEvent(n)},ChangeHandler=t=>{const{code:e,name:n,id:r,filename:o}=t,i=getCurrentService();return(t,a)=>{((t,a)=>{setState({name:n,id:r,filename:o,code:t,prevCode:e});const s=new CustomEvent("fileChange",{bubbles:!0,detail:{name:n,id:r,filePath:o,code:t,service:i?i.name:void 0}});document.body.dispatchEvent(s)})(t.getValue())}};!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}}((function(){return function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};e[a][0].call(d.exports,(function(t){return o(e[a][1][t]||t)}),d,d.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){(function(t){function n(){l=!0;for(var t,e,n=d.length;n;){for(e=d,d=[],t=-1;++t<n;)e[t]();n=d.length}l=!1}var r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var i=0,a=new o(n),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(n,0)};else{var c=new t.MessageChannel;c.port1.onmessage=n,r=function(){c.port2.postMessage(0)}}var l,d=[];e.exports=function(t){1!==d.push(t)||l||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){function r(){}function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,t!==r&&c(this,t)}function i(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function a(t,e,n){d((function(){var r;try{r=e(n)}catch(e){return u.reject(t,e)}r===t?u.reject(t,new TypeError("Cannot resolve promise with itself")):u.resolve(t,r)}))}function s(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function c(t,e){function n(e){o||(o=!0,u.reject(t,e))}function r(e){o||(o=!0,u.resolve(t,e))}var o=!1,i=l((function(){e(r,n)}));"error"===i.status&&n(i.value)}function l(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}var d=t(1),u={},p=["REJECTED"],f=["FULFILLED"],m=["PENDING"];e.exports=o,o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===f||"function"!=typeof e&&this.state===p)return this;var n=new this.constructor(r);return this.state!==m?a(n,this.state===f?t:e,this.outcome):this.queue.push(new i(n,t,e)),n},i.prototype.callFulfilled=function(t){u.resolve(this.promise,t)},i.prototype.otherCallFulfilled=function(t){a(this.promise,this.onFulfilled,t)},i.prototype.callRejected=function(t){u.reject(this.promise,t)},i.prototype.otherCallRejected=function(t){a(this.promise,this.onRejected,t)},u.resolve=function(t,e){var n=l(s,e);if("error"===n.status)return u.reject(t,n.value);var r=n.value;if(r)c(t,r);else{t.state=f,t.outcome=e;for(var o=-1,i=t.queue.length;++o<i;)t.queue[o].callFulfilled(e)}return t},u.reject=function(t,e){t.state=p,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},o.resolve=function(t){return t instanceof this?t:u.resolve(new this(r),t)},o.reject=function(t){var e=new this(r);return u.reject(e,t)},o.all=function(t){function e(t,e){n.resolve(t).then((function(t){a[e]=t,++s!==o||i||(i=!0,u.resolve(l,a))}),(function(t){i||(i=!0,u.reject(l,t))}))}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,i=!1;if(!o)return this.resolve([]);for(var a=new Array(o),s=0,c=-1,l=new this(r);++c<o;)e(t[c],c);return l},o.race=function(t){function e(t){n.resolve(t).then((function(t){i||(i=!0,u.resolve(s,t))}),(function(t){i||(i=!0,u.reject(s,t))}))}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,i=!1;if(!o)return this.resolve([]);for(var a=-1,s=new this(r);++a<o;)e(t[a]);return s}},{1:1}],3:[function(t,e,n){(function(e){"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,n){function r(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(e.type)}}function o(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function i(t,e,n){"function"==typeof e&&t.then(e),"function"==typeof n&&t.catch(n)}function a(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function s(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function c(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),o=0;o<e;o++)r[o]=t.charCodeAt(o);return n}function l(t){return"boolean"==typeof $?M.resolve($):function(t){return new M((function(e){var n=t.transaction(O,z),o=r([""]);n.objectStore(O).put(o,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}(t).then((function(t){return $=t}))}function d(t){var e=A[t.name],n={};n.promise=new M((function(t,e){n.resolve=t,n.reject=e})),e.deferredOperations.push(n),e.dbReady?e.dbReady=e.dbReady.then((function(){return n.promise})):e.dbReady=n.promise}function u(t){var e=A[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function p(t,e){var n=A[t.name].deferredOperations.pop();if(n)return n.reject(e),n.promise}function f(t,e){return new M((function(n,r){if(A[t.name]=A[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return n(t.db);d(t),t.db.close()}var o=[t.name];e&&o.push(t.version);var i=I.open.apply(I,o);e&&(i.onupgradeneeded=function(e){var n=i.result;try{n.createObjectStore(t.storeName),e.oldVersion<=1&&n.createObjectStore(O)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),i.onerror=function(t){t.preventDefault(),r(i.error)},i.onsuccess=function(){n(i.result),u(t)}}))}function m(t){return f(t,!1)}function h(t){return f(t,!0)}function v(t,e){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),r=t.version<t.db.version,o=t.version>t.db.version;if(r&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),o||n){if(n){var i=t.db.version+1;i>t.version&&(t.version=i)}return!0}return!1}function g(t){return r([c(atob(t.data))],{type:t.type})}function y(t){return t&&t.__local_forage_encoded_blob}function b(t){var e=this,n=e._initReady().then((function(){var t=A[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return i(n,t,t),n}function w(t,e,n,r){void 0===r&&(r=1);try{var o=t.db.transaction(t.storeName,e);n(null,o)}catch(o){if(r>0&&(!t.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return M.resolve().then((function(){if(!t.db||"NotFoundError"===o.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),h(t)})).then((function(){return function(t){d(t);for(var e=A[t.name],n=e.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return t.db=null,m(t).then((function(e){return t.db=e,v(t)?h(t):e})).then((function(r){t.db=e.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(e){throw p(t,e),e}))}(t).then((function(){w(t,e,n,r-1)}))})).catch(n);n(o)}}function S(t){var e,n,r,o,i,a=.75*t.length,s=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var l=new ArrayBuffer(a),d=new Uint8Array(l);for(e=0;e<s;e+=4)n=R.indexOf(t[e]),r=R.indexOf(t[e+1]),o=R.indexOf(t[e+2]),i=R.indexOf(t[e+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|o>>2,d[c++]=(3&o)<<6|63&i;return l}function x(t){var e,n=new Uint8Array(t),r="";for(e=0;e<n.length;e+=3)r+=R[n[e]>>2],r+=R[(3&n[e])<<4|n[e+1]>>4],r+=R[(15&n[e+1])<<2|n[e+2]>>6],r+=R[63&n[e+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function E(t,e,n,r){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function C(t,e,n,r,o,i){t.executeSql(n,r,o,(function(t,a){a.code===a.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],(function(t,s){s.rows.length?i(t,a):E(t,e,(function(){t.executeSql(n,r,o,i)}),i)}),i):i(t,a)}),i)}function T(t,e,n,r){var i=this;t=a(t);var s=new M((function(o,a){i.ready().then((function(){void 0===e&&(e=null);var s=e,c=i._dbInfo;c.serializer.serialize(e,(function(e,l){l?a(l):c.db.transaction((function(n){C(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){o(s)}),(function(t,e){a(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(r>0)return void o(T.apply(i,[t,s,n,r-1]));a(e)}}))}))})).catch(a)}));return o(s,n),s}function k(t){return new M((function(e,n){t.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).name);e({db:t,storeNames:o})}),(function(t,e){n(e)}))}),(function(t){n(t)}))}))}function D(t,e){var n=t.name+"/";return t.storeName!==e.storeName&&(n+=t.storeName+"/"),n}function L(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||localStorage.length>0}function _(t,e){t[e]=function(){var n=arguments;return t.ready().then((function(){return t[e].apply(t,n)}))}}function j(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var n in e)e.hasOwnProperty(n)&&(dt(e[n])?arguments[0][n]=e[n].slice():arguments[0][n]=e[n])}return arguments[0]}var N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();"undefined"==typeof Promise&&t(3);var M=Promise,O="local-forage-detect-blob-support",$=void 0,A={},P=Object.prototype.toString,F="readonly",z="readwrite",B={_driver:"asyncStorage",_initStorage:function(t){function e(){return M.resolve()}var n=this,r={db:null};if(t)for(var o in t)r[o]=t[o];var i=A[r.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},A[r.name]=i),i.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=b);for(var a=[],s=0;s<i.forages.length;s++){var c=i.forages[s];c!==n&&a.push(c._initReady().catch(e))}var l=i.forages.slice(0);return M.all(a).then((function(){return r.db=i.db,m(r)})).then((function(t){return r.db=t,v(r,n._defaultConfig.version)?h(r):t})).then((function(t){r.db=i.db=t,n._dbInfo=r;for(var e=0;e<l.length;e++){var o=l[e];o!==n&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}}))},_support:function(){try{if(!I||!I.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var n=this,r=new M((function(e,r){n.ready().then((function(){w(n._dbInfo,F,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;y(r)&&(r=g(r));var o=t(r,n.key,s++);void 0!==o?e(o):n.continue()}else e()},a.onerror=function(){r(a.error)}}catch(t){r(t)}}))})).catch(r)}));return o(r,e),r},getItem:function(t,e){var n=this;t=a(t);var r=new M((function(e,r){n.ready().then((function(){w(n._dbInfo,F,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).get(t);a.onsuccess=function(){var t=a.result;void 0===t&&(t=null),y(t)&&(t=g(t)),e(t)},a.onerror=function(){r(a.error)}}catch(t){r(t)}}))})).catch(r)}));return o(r,e),r},setItem:function(t,e,n){var r=this;t=a(t);var i=new M((function(n,o){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===P.call(e)?l(i.db).then((function(t){return t?e:function(t){return new M((function(e,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:t.type})},r.readAsBinaryString(t)}))}(e)})):e})).then((function(e){w(r._dbInfo,z,(function(i,a){if(i)return o(i);try{var s=a.objectStore(r._dbInfo.storeName);null===e&&(e=void 0);var c=s.put(e,t);a.oncomplete=function(){void 0===e&&(e=null),n(e)},a.onabort=a.onerror=function(){var t=c.error?c.error:c.transaction.error;o(t)}}catch(t){o(t)}}))})).catch(o)}));return o(i,n),i},removeItem:function(t,e){var n=this;t=a(t);var r=new M((function(e,r){n.ready().then((function(){w(n._dbInfo,z,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).delete(t);i.oncomplete=function(){e()},i.onerror=function(){r(a.error)},i.onabort=function(){var t=a.error?a.error:a.transaction.error;r(t)}}catch(t){r(t)}}))})).catch(r)}));return o(r,e),r},clear:function(t){var e=this,n=new M((function(t,n){e.ready().then((function(){w(e._dbInfo,z,(function(r,o){if(r)return n(r);try{var i=o.objectStore(e._dbInfo.storeName).clear();o.oncomplete=function(){t()},o.onabort=o.onerror=function(){var t=i.error?i.error:i.transaction.error;n(t)}}catch(t){n(t)}}))})).catch(n)}));return o(n,t),n},length:function(t){var e=this,n=new M((function(t,n){e.ready().then((function(){w(e._dbInfo,F,(function(r,o){if(r)return n(r);try{var i=o.objectStore(e._dbInfo.storeName).count();i.onsuccess=function(){t(i.result)},i.onerror=function(){n(i.error)}}catch(t){n(t)}}))})).catch(n)}));return o(n,t),n},key:function(t,e){var n=this,r=new M((function(e,r){t<0?e(null):n.ready().then((function(){w(n._dbInfo,F,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName),s=!1,c=a.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===t||s?e(n.key):(s=!0,n.advance(t)):e(null)},c.onerror=function(){r(c.error)}}catch(t){r(t)}}))})).catch(r)}));return o(r,e),r},keys:function(t){var e=this,n=new M((function(t,n){e.ready().then((function(){w(e._dbInfo,F,(function(r,o){if(r)return n(r);try{var i=o.objectStore(e._dbInfo.storeName).openKeyCursor(),a=[];i.onsuccess=function(){var e=i.result;e?(a.push(e.key),e.continue()):t(a)},i.onerror=function(){n(i.error)}}catch(t){n(t)}}))})).catch(n)}));return o(n,t),n},dropInstance:function(t,e){e=s.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,i=this;if(t.name){var a=t.name===n.name&&i._dbInfo.db,c=a?M.resolve(i._dbInfo.db):m(t).then((function(e){var n=A[t.name],r=n.forages;n.db=e;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=e;return e}));r=t.storeName?c.then((function(e){if(e.objectStoreNames.contains(t.storeName)){var n=e.version+1;d(t);var r=A[t.name],o=r.forages;e.close();for(var i=0;i<o.length;i++){var a=o[i];a._dbInfo.db=null,a._dbInfo.version=n}return new M((function(e,r){var o=I.open(t.name,n);o.onerror=function(t){o.result.close(),r(t)},o.onupgradeneeded=function(){o.result.deleteObjectStore(t.storeName)},o.onsuccess=function(){var t=o.result;t.close(),e(t)}})).then((function(t){r.db=t;for(var e=0;e<o.length;e++){var n=o[e];n._dbInfo.db=t,u(n._dbInfo)}})).catch((function(e){throw(p(t,e)||M.resolve()).catch((function(){})),e}))}})):c.then((function(e){d(t);var n=A[t.name],r=n.forages;e.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;return new M((function(e,n){var r=I.deleteDatabase(t.name);r.onerror=r.onblocked=function(t){var e=r.result;e&&e.close(),n(t)},r.onsuccess=function(){var t=r.result;t&&t.close(),e(t)}})).then((function(t){n.db=t;for(var e=0;e<r.length;e++)u(r[e]._dbInfo)})).catch((function(e){throw(p(t,e)||M.resolve()).catch((function(){})),e}))}))}else r=M.reject("Invalid arguments");return o(r,e),r}},R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q="~~local_forage_type~",U=/^~~local_forage_type~([^~]+)~/,H="__lfsc__:",W=H.length,V="arbf",G="blob",J="si08",K="ui08",X="uic8",Y="si16",Q="si32",Z="ur16",tt="ui32",et="fl32",nt="fl64",rt=W+V.length,ot=Object.prototype.toString,it={serialize:function(t,e){var n="";if(t&&(n=ot.call(t)),t&&("[object ArrayBuffer]"===n||t.buffer&&"[object ArrayBuffer]"===ot.call(t.buffer))){var r,o=H;t instanceof ArrayBuffer?(r=t,o+=V):(r=t.buffer,"[object Int8Array]"===n?o+=J:"[object Uint8Array]"===n?o+=K:"[object Uint8ClampedArray]"===n?o+=X:"[object Int16Array]"===n?o+=Y:"[object Uint16Array]"===n?o+=Z:"[object Int32Array]"===n?o+=Q:"[object Uint32Array]"===n?o+=tt:"[object Float32Array]"===n?o+=et:"[object Float64Array]"===n?o+=nt:e(new Error("Failed to get type for BinaryArray"))),e(o+x(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n=q+t.type+"~"+x(this.result);e(H+G+n)},i.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(n){console.error("Couldn't convert value into a JSON string: ",t),e(null,n)}},deserialize:function(t){if(t.substring(0,W)!==H)return JSON.parse(t);var e,n=t.substring(rt),o=t.substring(W,rt);if(o===G&&U.test(n)){var i=n.match(U);e=i[1],n=n.substring(i[0].length)}var a=S(n);switch(o){case V:return a;case G:return r([a],{type:e});case J:return new Int8Array(a);case K:return new Uint8Array(a);case X:return new Uint8ClampedArray(a);case Y:return new Int16Array(a);case Z:return new Uint16Array(a);case Q:return new Int32Array(a);case tt:return new Uint32Array(a);case et:return new Float32Array(a);case nt:return new Float64Array(a);default:throw new Error("Unkown type: "+o)}},stringToBuffer:S,bufferToString:x},at={_driver:"webSQLStorage",_initStorage:function(t){var e=this,n={db:null};if(t)for(var r in t)n[r]="string"!=typeof t[r]?t[r].toString():t[r];var o=new M((function(t,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(t){return r(t)}n.db.transaction((function(o){E(o,n,(function(){e._dbInfo=n,t()}),(function(t,e){r(e)}))}),r)}));return n.serializer=it,o},_support:"function"==typeof openDatabase,iterate:function(t,e){var n=this,r=new M((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){C(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var i=r.rows,a=i.length,s=0;s<a;s++){var c=i.item(s),l=c.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=t(l,c.key,s+1)))return void e(l)}e()}),(function(t,e){r(e)}))}))})).catch(r)}));return o(r,e),r},getItem:function(t,e){var n=this;t=a(t);var r=new M((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){C(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return o(r,e),r},setItem:function(t,e,n){return T.apply(this,[t,e,n,1])},removeItem:function(t,e){var n=this;t=a(t);var r=new M((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){C(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){r(e)}))}))})).catch(r)}));return o(r,e),r},clear:function(t){var e=this,n=new M((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){C(e,r,"DELETE FROM "+r.storeName,[],(function(){t()}),(function(t,e){n(e)}))}))})).catch(n)}));return o(n,t),n},length:function(t){var e=this,n=new M((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){C(e,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(e,n){var r=n.rows.item(0).c;t(r)}),(function(t,e){n(e)}))}))})).catch(n)}));return o(n,t),n},key:function(t,e){var n=this,r=new M((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){C(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,n){var r=n.rows.length?n.rows.item(0).key:null;e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return o(r,e),r},keys:function(t){var e=this,n=new M((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){C(e,r,"SELECT key FROM "+r.storeName,[],(function(e,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);t(r)}),(function(t,e){n(e)}))}))})).catch(n)}));return o(n,t),n},dropInstance:function(t,e){e=s.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,i=this;return r=t.name?new M((function(e){var r;r=t.name===n.name?i._dbInfo.db:openDatabase(t.name,"","",0),e(t.storeName?{db:r,storeNames:[t.storeName]}:k(r))})).then((function(t){return new M((function(e,n){t.db.transaction((function(r){function o(t){return new M((function(e,n){r.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){e()}),(function(t,e){n(e)}))}))}for(var i=[],a=0,s=t.storeNames.length;a<s;a++)i.push(o(t.storeNames[a]));M.all(i).then((function(){e()})).catch((function(t){n(t)}))}),(function(t){n(t)}))}))})):M.reject("Invalid arguments"),o(r,e),r}},st={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var n in t)e[n]=t[n];return e.keyPrefix=D(t,this._defaultConfig),L()?(this._dbInfo=e,e.serializer=it,M.resolve()):M.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var n=this,r=n.ready().then((function(){for(var e=n._dbInfo,r=e.keyPrefix,o=r.length,i=localStorage.length,a=1,s=0;s<i;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=e.serializer.deserialize(l)),void 0!==(l=t(l,c.substring(o),a++)))return l}}}));return o(r,e),r},getItem:function(t,e){var n=this;t=a(t);var r=n.ready().then((function(){var e=n._dbInfo,r=localStorage.getItem(e.keyPrefix+t);return r&&(r=e.serializer.deserialize(r)),r}));return o(r,e),r},setItem:function(t,e,n){var r=this;t=a(t);var i=r.ready().then((function(){void 0===e&&(e=null);var n=e;return new M((function(o,i){var a=r._dbInfo;a.serializer.serialize(e,(function(e,r){if(r)i(r);else try{localStorage.setItem(a.keyPrefix+t,e),o(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||i(t),i(t)}}))}))}));return o(i,n),i},removeItem:function(t,e){var n=this;t=a(t);var r=n.ready().then((function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return o(r,e),r},clear:function(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(t)&&localStorage.removeItem(r)}}));return o(n,t),n},length:function(t){var e=this.keys().then((function(t){return t.length}));return o(e,t),e},key:function(t,e){var n=this,r=n.ready().then((function(){var e,r=n._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(r.keyPrefix.length)),e}));return o(r,e),r},keys:function(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var i=localStorage.key(o);0===i.indexOf(t.keyPrefix)&&r.push(i.substring(t.keyPrefix.length))}return r}));return o(n,t),n},dropInstance:function(t,e){if(e=s.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var r,i=this;return r=t.name?new M((function(e){e(t.storeName?D(t,i._defaultConfig):t.name+"/")})).then((function(t){for(var e=localStorage.length-1;e>=0;e--){var n=localStorage.key(e);0===n.indexOf(t)&&localStorage.removeItem(n)}})):M.reject("Invalid arguments"),o(r,e),r}},ct=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},lt=function(t,e){for(var n=t.length,r=0;r<n;){if(ct(t[r],e))return!0;r++}return!1},dt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ut={},pt={},ft={INDEXEDDB:B,WEBSQL:at,LOCALSTORAGE:st},mt=[ft.INDEXEDDB._driver,ft.WEBSQL._driver,ft.LOCALSTORAGE._driver],ht=["dropInstance"],vt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ht),gt={description:"",driver:mt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},yt=function(){function t(e){for(var n in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ft)if(ft.hasOwnProperty(n)){var r=ft[n],o=r._driver;this[n]=o,ut[o]||this.defineDriver(r)}this._defaultConfig=j({},gt),this._config=j({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":N(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,n){var r=new M((function(e,n){try{var r=t._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void n(i);for(var a=vt.concat("_initStorage"),s=0,c=a.length;s<c;s++){var l=a[s];if((!lt(ht,l)||t[l])&&"function"!=typeof t[l])return void n(i)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),n=M.reject(e);return o(n,arguments[arguments.length-1]),n}},n=0,r=ht.length;n<r;n++){var i=ht[n];t[i]||(t[i]=e(i))}}();var d=function(n){ut[r]&&console.info("Redefining LocalForage driver: "+r),ut[r]=t,pt[r]=n,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(d,n):d(!!t._support):d(!0)}catch(t){n(t)}}));return i(r,e,n),r},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,n){var r=ut[t]?M.resolve(ut[t]):M.reject(new Error("Driver not found."));return i(r,e,n),r},t.prototype.getSerializer=function(t){var e=M.resolve(it);return i(e,t),e},t.prototype.ready=function(t){var e=this,n=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return i(n,t,t),n},t.prototype.setDriver=function(t,e,n){function r(){a._config.driver=a.driver()}function o(t){return a._extend(t),r(),a._ready=a._initStorage(a._config),a._ready}var a=this;dt(t)||(t=[t]);var s=this._getSupportedDrivers(t),c=null!==this._driverSet?this._driverSet.catch((function(){return M.resolve()})):M.resolve();return this._driverSet=c.then((function(){var t=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(t).then((function(t){a._driver=t._driver,r(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(t){return function(){var e=0;return function n(){for(;e<t.length;){var i=t[e];return e++,a._dbInfo=null,a._ready=null,a.getDriver(i).then(o).catch(n)}r();var s=new Error("No available storage method found.");return a._driverSet=M.reject(s),a._driverSet}()}}(s)}))})).catch((function(){r();var t=new Error("No available storage method found.");return a._driverSet=M.reject(t),a._driverSet})),i(this._driverSet,e,n),this._driverSet},t.prototype.supports=function(t){return!!pt[t]},t.prototype._extend=function(t){j(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var o=t[n];this.supports(o)&&e.push(o)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=vt.length;t<e;t++)_(this,vt[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),bt=new yt;e.exports=bt},{3:3}]},{},[4])(4)}));const getFilePath=getFilePath$1(getCurrentService);function _Editor(t){const e=EditorTabs(),n=StatusBar(),r=InlineEditor(ChangeHandler,EditorTabs,CursorActivityHandler),o={getCurrentFile:getCurrentFile,getFilePath:getFilePath,showMenu:()=>window.showMenu,switchEditor:t=>switchEditor(t,{editor:r,context:o}),messageEditor:t=>messageEditor(t,{editor:r,context:o}),systemDocsErrors:[],tabs:e,status:n};attachEvents(events,o)}const Editor$1=_Editor,isRunningAsModule=document.location.href.includes("_/modules");if(!isRunningAsModule){const t=document.createElement("base");t.href="../../",document.getElementsByTagName("head")[0].appendChild(t)}const head=document.getElementsByTagName("head")[0],cssnode=document.createElement("link");cssnode.type="text/css",cssnode.rel="stylesheet",cssnode.href="./editor.css",head.appendChild(cssnode),window.showMenu=t=>{},Editor$1();const currentServiceId=localStorage.getItem("lastService"),serviceUrl=`/service/read/${currentServiceId}`,{result:[currentService]}=await fetch(serviceUrl).then((t=>t.json())),service=currentService;service.state.selected={name:service.state.selected.split("/").pop(),path:`${service.name}/${service.state.selected}`},console.log(service),initState([service],service),trigger({e:{},type:"operationDone",params:{},source:{},data:{},detail:{op:"read",id:1,result:[service]}}),console.log("Listeners:\n"+list().map((t=>t.split("__").reverse().join(": "))).sort().join("\n")),console.log("Triggers:\n"+listTriggers().map((t=>t.split("__").reverse().join(": "))).sort().join("\n"));